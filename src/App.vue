<template>
  <div id="app">

    <!-- Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© -->
    <div class="circle-btn lang-btn" @click="toggleLanguageMenu">
      ğŸŒ
      <span class="lang-code">{{ currentLang }}</span>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª -->
    <div v-if="showLangMenu" class="lang-menu">
      <div 
        class="lang-item" 
        v-for="l in languages" 
        :key="l.code"
        @click="setLanguage(l)"
      >
        {{ l.name }}
      </div>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¯Ø¹Ù… -->
    <a class="circle-btn support-btn"
       href="https://t.me/American_38X"
       target="_blank">
      ğŸ§
    </a>

    <!-- Ø§Ù„ØµÙØ­Ø§Øª -->
    <router-view />

    <!-- â­ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ø¯ÙˆÙ† ÙˆÙ…ÙŠØ¶ â­ -->
    <BottomNav v-if="authLoaded && showBottomNav" />

    <!-- Ø¥Ø¹Ù„Ø§Ù† Popup -->
    <div id="companyAd" class="ad-overlay" v-if="showAd">
      <div class="ad-box">
        <h2>Ø¥Ø¹Ù„Ø§Ù†</h2>

        <div class="ad-content">
          <p>
            ğŸ‰ğŸ‰ğŸ‰ Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹! ØªØ£Ø³Ø³Øª Mall of the world ÙÙŠ Ø³Ù†ØºØ§ÙÙˆØ±Ø© ÙÙŠ 20 Ø£ØºØ³Ø·Ø³ 2021 ÙˆÙ…Ù‚Ø±Ù‡Ø§ Ø­Ø§Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ÙÙŠ Ø³Ù†ØºØ§ÙÙˆØ±Ø©. Ù†Ø­Ù† Ø´Ø±ÙƒØ© Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…Ø¹ ÙØ±ÙŠÙ‚ ØªÙ‚Ù†ÙŠ Ù‚ÙˆÙŠ ÙˆÙ‚ÙˆØ© Ù…Ø§Ù„ÙŠØ© Ù‚ÙˆÙŠØ©.
            <br>
            ÙŠØªØ¹Ø§ÙˆÙ† Mall of the world Ù…Ø¹ Ø¹Ø´Ø±Ø§Øª Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…Ø«Ù„ Amazon Ùˆ eBay Ùˆ Tiktok Ùˆ Aliexpress Ùˆ Alibaba Ùˆ ShopeeØŒ Ø¥Ù„Ø®. Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ¬Ø§Ø± Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ù…ØŒ ÙˆÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§ ØªØ­Ù‚ÙŠÙ‚ Ø£Ø±Ø¨Ø§Ø­ Ù…Ù†Ù‡.
            <br><br>
            ğŸ‘1: Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù…Ø¨Ù„Øº Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø´Ø­Ù†: 12 USDTØŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ù†Ù‚Ø¯ÙŠ: 3 USDT
            <br>
            ğŸ’°2: ØªØ³ØªØ«Ù…Ø± Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù„Ù….
            <br>
            ğŸŒˆ3: ÙˆÙ‚Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© Ù‡Ùˆ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ø¸Ù‡Ø±Ø§Ù‹.
            <br>
            ğŸ•¯4: ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ø§Ù„Ù†Ù‚Ø¯ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙŠÙˆÙ….
          </p>
        </div>

        <button @click="closeAd">Ø£Ù†Ø§ Ø£Ø¹Ø±Ù</button>
      </div>
    </div>
  </div>
</template>

<script>
import BottomNav from "./components/BottomNav.vue";
import { getAuth, onAuthStateChanged } from "firebase/auth";

export default {
  components: { BottomNav },

  data() {
    return {
      authLoaded: false,
      user: null,

      showLangMenu: false,
      currentLang: "AR", // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

      showAd: false,  // Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†

      languages: [
        { name: "Polski", code: "PL" },
        { name: "English", code: "EN" },
        { name: "FranÃ§ais", code: "FR" },
        { name: "Italiano", code: "IT" },
        { name: "æ—¥æœ¬èª", code: "JP" },
        { name: "í•œêµ­ì¸", code: "KR" },
        { name: "Deutsch", code: "DE" },
        { name: "Ğ ÑƒÑÑĞºĞ¸Ğ¹", code: "RU" },
        { name: "Tiáº¿ng Viá»‡t", code: "VI" },
        { name: "PortuguÃªs", code: "PT" },
        { name: "TÃ¼rkÃ§e", code: "TR" },
        { name: "EspaÃ±ol", code: "ES" },
        { name: "ÙØ§Ø±Ø³ÛŒ", code: "FA" },
        { name: "Ø§Ù„Ø¹Ø±Ø¨ÙŠ", code: "AR" }
      ]
    };
  },

  created() {
    const auth = getAuth();

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    const saved = localStorage.getItem("app_language");
    if (saved) this.currentLang = saved;

    onAuthStateChanged(auth, (u) => {
      this.user = u;
      this.authLoaded = true;
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      if (this.user) {
        this.showAd = true;
      }
    });
  },

  computed: {
    showBottomNav() {
      if (!this.user) return false;

      const path = this.$route.path;
      const hidden = ["/login", "/register", "/admin", "/403"];

      return !hidden.some((r) => path.startsWith(r));
    }
  },

  methods: {
    toggleLanguageMenu() {
      this.showLangMenu = !this.showLangMenu;
    },

    setLanguage(lang) {
      this.currentLang = lang.code;
      localStorage.setItem("app_language", lang.code);
      this.showLangMenu = false;
    },

    closeAd() {
      this.showAd = false; // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
    }
  }
};
</script>

<style>
body {
  margin: 0;
}

.circle-btn {
  position: fixed;
  top: 90px;
  width: 48px;
  height: 48px;
  background: #ffffff;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #333;
  font-size: 20px;
  cursor: pointer;
  z-index: 9999;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
  flex-direction: column;
}

.lang-code {
  font-size: 10px;
  margin-top: -4px;
  opacity: 0.8;
}

.lang-btn {
  right: 15px;
}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
.lang-menu {
  position: fixed;
  top: 145px;
  right: 15px;
  width: 140px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  z-index: 9999;
  overflow: hidden;
}

.lang-item {
  padding: 10px;
  font-size: 15px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
  text-align: right;
}

.lang-item:last-child {
  border-bottom: none;
}

.lang-item:hover {
  background: #f5faff;
}

.support-btn {
  left: 15px;
  text-decoration: none;
}

/* Ø¥Ø¹Ù„Ø§Ù† Popup */
.ad-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.ad-box {
  background: #eaf2ff;
  width: 90%;
  max-width: 400px;
  margin: 15% auto;
  border-radius: 15px;
  padding: 15px;
  text-align: center;
}

.ad-box h2 {
  background: #3b82f6;
  color: white;
  padding: 10px;
  border-radius: 10px;
}

.ad-content {
  max-height: 250px;
  overflow-y: auto;
  margin: 10px 0;
  font-size: 14px;
}

.ad-box button {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
}
</style>
